<!DOCTYPE html>
<html>
<head>
    <title>Blockchain Casino (EVE Vault)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/4.0.3/web3.min.js"></script>
</head>
<body>
    <h1>Welcome to the Blockchain Casino (EVE Vault)</h1>
    <button onclick="connectEveVault()">Connect EVE Wallet</button>
    <input type="number" id="betAmount" placeholder="Enter bet amount (EVE)">
    <button onclick="placeBet()">Place Bet</button>
    <p id="wallet">Wallet: Not Connected</p>
    <p id="result"></p>

    <script>
        let web3;
        let userAccount;
        const contractAddress = "YOUR_NEW_CASINO_CONTRACT"; // Replace with deployed casino contract
        const eveTokenAddress = "EVE_TOKEN_CONTRACT_ADDRESS"; // Replace with the EVE token contract address

        const casinoABI = [
            {
                "constant": false,
                "inputs": [{"name": "_amount", "type": "uint256"}],
                "name": "bet",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        const tokenABI = [
            {
                "constant": false,
                "inputs": [
                    {"name": "spender", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "approve",
                "outputs": [{"name": "", "type": "bool"}],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        async function connectEveVault() {
            try {
                const response = await fetch("https://devnet-wallet-api.nursery.reitnorf.com/account", {
                    method: "GET",
                    headers: { "Content-Type": "application/json" }
                });

                if (!response.ok) {
                    throw new Error("Failed to connect to EVE Wallet.");
                }

                const data = await response.json();
                userAccount = data.address;

                if (userAccount) {
                    web3 = new Web3(new Web3.providers.HttpProvider("https://garnet-rpc.live.tech.evefrontier.com"));
                    document.getElementById("wallet").innerText = `Wallet: ${userAccount}`;
                    console.log("Connected to EVE Wallet:", userAccount);
                } else {
                    throw new Error("No wallet address found.");
                }
            } catch (error) {
                console.error("EVE Vault Connection Error:", error);
                alert("Failed to connect to EVE Wallet. Make sure you are logged in.");
            }
        }

        async function placeBet() {
            if (!web3 || !userAccount) {
                alert("Web3 not initialized. Please connect your EVE Wallet first.");
                return;
            }

            const casino = new web3.eth.Contract(casinoABI, contractAddress);
            const eveToken = new web3.eth.Contract(tokenABI, eveTokenAddress);
            const betAmount = document.getElementById("betAmount").value;

            if (betAmount <= 0) {
                alert("Enter a valid bet amount.");
                return;
            }

            const weiAmount = web3.utils.toWei(betAmount, "ether"); // Convert to smallest unit

            try {
                // Approve tokens first
                console.log("Approving tokens...");
                await eveToken.methods.approve(contractAddress, weiAmount).send({ from: userAccount });

                console.log("Placing bet...");
                // Place bet
                const transaction = await casino.methods.bet(weiAmount).send({ from: userAccount });

                document.getElementById("result").innerText = "Bet placed! Check if you won!";
                console.log("Transaction successful:", transaction);
            } catch (error) {
                console.error("Transaction failed:", error);
                document.getElementById("result").innerText = "Bet failed.";
            }
        }
    </script>
</body>
</html>
